<!DOCTYPE html>
<html lang="fr">
<head>
  <meta name="referrer" content="no-referrer">
<meta name="robots" content="noindex, nofollow">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Configuration Tradi'home</title>

  <!-- Google Tag (gtag.js) - Google Ads + GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=GT-WPL2H37J"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    // ✅ CONSENT MODE - Accepter le tracking dans l'iframe configurateur
    // Ceci override le consent denied du parent Webflow
    gtag('consent', 'update', {
      'ad_storage': 'granted',
      'ad_user_data': 'granted',
      'ad_personalization': 'granted',
      'analytics_storage': 'granted'  // ← Permet à GA4 de recevoir les événements
    });

    // Google Tag
    gtag('config', 'GT-WPL2H37J');

    // Google Ads
    gtag('config', 'AW-17802163047');

    // Google Analytics 4
    gtag('config', 'G-864MHX1HKR', {
      'send_page_view': true,
      'page_title': 'Configurateur Tradi\'home',
      'page_location': window.location.href
    });
  </script>

  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1875020966472884');
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1875020966472884&ev=PageView&noscript=1"/>
  </noscript>
  <!-- End Meta Pixel Code -->

  <!-- Calendly CSS pour PopupWidget -->
  <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">

  <script type="module" src="https://unpkg.com/@google/model-viewer@1.12.0/dist/model-viewer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    * { box-sizing:border-box; margin:0; padding:0 }
    html, body { min-height:100%; font-family:sans-serif; background:#f0f2f5 }
/* Masquer la notification Chrome dans l'iframe */
html {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

body {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

/* Masquer les éléments système */
body > *:first-child:not(.fixed-price):not(#configurator) {
  display: none !important;
}
    .fixed-price {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 1000;
      text-align: center;
      transform: translateY(-100%);
      transition: transform 0.3s ease;
    }

    .fixed-price.visible {
      transform: translateY(0);
    }

    .fixed-price-label {
      font-size: 1rem;
      color: #666;
      margin-right: 1rem;
    }

    .fixed-price-amount {
      font-size: 1.5rem;
      font-weight: bold;
      color: #1a202c;
    }

    /* DESKTOP LAYOUT - 2 COLONNES (60% / 40%) */
    #configurator {
      display: grid;
      grid-template-columns: 60fr 40fr;
      min-height: 100vh;
      gap: 0;
      padding: 0;
      background: #f5f5f5;
    }

    /* COLONNE GAUCHE - 3D FIXE */
    .left-panel {
      position: sticky;
      top: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: #ffffff;
    }

    /* TOP SECTION - MODÈLE 3D */
    .top-section {
      flex: 1;
      position: relative;
    }

    /* MODÈLE 3D */
    .viewer-card {
      background: #fff;
      overflow: hidden;
      height: 100%;
      position: relative;
    }

    /* SECTION RÉSUMÉ SOUS LE 3D - Design Premium */
    .summary-section {
      max-height: 0;
      overflow: hidden;
      background: #ffffff;
      margin: 1rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.6s ease, transform 0.6s ease;
      padding: 0;
      opacity: 0;
      transform: translateY(-10px);
    }

    .summary-section.visible {
      max-height: 500px;
      overflow-y: auto;
      padding: 1.5rem;
      opacity: 1;
      transform: translateY(0);
    }

    .summary-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1a1a1a;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 0.75rem;
    }

    .summary-grid {
      display: grid;
      gap: 0.5rem;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background: #f9fafb;
      border-radius: 8px;
      font-size: 0.9rem;
      border: 1px solid #f0f0f0;
      transition: all 0.2s ease;
    }

    .summary-item:hover {
      background: #f3f4f6;
      border-color: #e5e7eb;
    }

    .summary-item-label {
      font-weight: 500;
      color: #4b5563;
    }

    .summary-item-value {
      color: #1a1a1a;
      font-weight: 600;
    }

    /* COLONNE DROITE - OPTIONS SCROLLABLES */
    .right-panel {
      background: #fff;
      overflow-y: auto;
      height: 100vh;
    }

    model-viewer {
      width: 100%;
      height: 100%;
      background: #dddddd;
      pointer-events: all;
      touch-action: pan-x pan-y; /* Permet la rotation du modèle mais empêche le scroll de la page */
    }

    /* FLÈCHES D'INDICATION ROTATION STYLE VOLKSWAGEN */
    .rotation-indicators {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      pointer-events: none;
      z-index: 10;
      opacity: 0.8;
      animation: fadeInOut 4s infinite;
    }

    .rotation-hint {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px 20px;
      border-radius: 25px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      font-size: 0.8rem;
      color: #555;
      font-weight: 500;
    }

    .rotation-arrows {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .rotation-arrow {
      width: 24px;
      height: 24px;
      border: 2px solid #1976d2;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #1976d2;
      background: white;
      font-weight: bold;
    }

    @keyframes fadeInOut {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    /* BOTTOM SECTION - CONFIGURATION */
    .bottom-section {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 1rem;
      flex: 1;
    }

    .config-header {
      text-align: center;
      margin-bottom: 1rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 0.75rem;
    }

    .config-header h2 {
      font-size: 1.5rem;
      color: #222;
      margin-bottom: 0.5rem;
    }

    .config-header .current-price {
      font-size: 2rem;
      font-weight: bold;
      color: #1a202c;
    }

    .config-content {
      padding: 2rem;
    }

    /* SYSTÈME D'ACCORDION - STYLE PORSCHE PREMIUM */
    .accordion-section {
      margin-bottom: 0.5rem;
      border: none;
      border-bottom: 1px solid #e5e7eb;
      overflow: hidden;
      background: transparent;
    }

    .accordion-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 0;
      background: transparent;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
      border: none;
    }

    .accordion-header:hover {
      opacity: 0.7;
    }

    .accordion-header.active {
      background: transparent;
      border-bottom: none;
    }

    .accordion-title {
      display: flex;
      align-items: center;
      gap: 0;
      font-size: 0.95rem;
      font-weight: 500;
      color: #1a1a1a;
      letter-spacing: -0.01em;
    }

    .accordion-icon {
      display: none;
    }

    .accordion-toggle {
      font-size: 1.25rem;
      font-weight: 300;
      color: #1a1a1a;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .accordion-toggle::before {
      content: '+';
    }

    .accordion-header.active .accordion-toggle {
      transform: rotate(45deg);
    }

    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.4s ease;
      padding: 0;  /* Pas de padding quand fermé */
    }

    .accordion-content.active {
      max-height: 2000px;
      padding: 1.5rem;  /* Padding seulement quand ouvert */
    }

    /* CARDS STYLE DE VIE - DESIGN PREMIUM PORSCHE */
    .lifestyle-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    .lifestyle-card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 0;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: center;
      background: #ffffff;
      position: relative;
      overflow: hidden;
    }

    .lifestyle-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border-color: #d1d5db;
    }

    .lifestyle-card.selected {
      border-color: #1a1a1a;
      border-width: 2px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
    }

    .lifestyle-card.selected::after {
      content: '✓';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      background: #1a1a1a;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      z-index: 10;
    }

    .lifestyle-icon {
      width: 100%;
      height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #f9fafb;
    }

    .lifestyle-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .lifestyle-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin: 1rem 0.75rem 0.5rem;
      color: #1a1a1a;
      line-height: 1.3;
    }

    .lifestyle-description {
      font-size: 0.75rem;
      color: #6b7280;
      line-height: 1.4;
      margin: 0 0.75rem;
      padding-bottom: 1rem;
    }

    .lifestyle-btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      background: #1a1a1a;
      color: white;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      text-decoration: none;
      opacity: 0;
      transform: translateY(5px);
      transition: all 0.3s ease;
      margin: 0 0.75rem 1rem;
    }

    .lifestyle-card.selected .lifestyle-btn {
      opacity: 1;
      transform: translateY(0);
    }

    .lifestyle-btn:hover {
      background: #404040;
    }

    /* OPTIONS TERRAIN */
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .radio-option {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .radio-option:hover {
      border-color: #cbd5e1;
      background: #f8fafc;
    }

    .radio-option.selected {
      border-color: #006aff;
      background: #eff6ff;
    }

    .radio-option input[type="radio"] {
      margin-top: 0.25rem;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .radio-label {
      flex: 1;
      font-size: 0.9rem;
      color: #374151;
      cursor: pointer;
    }

    .conditional-field {
      margin-top: 0.5rem;
      margin-left: 1.75rem;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .conditional-field.visible {
      max-height: 300px;
    }

    .conditional-field input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }

    .conditional-field input:focus {
      outline: none;
      border-color: #1a1a1a;
      box-shadow: 0 0 0 3px rgba(26, 26, 26, 0.1);
    }

    /* CTA box pour terrain */
    .terrain-cta-box {
      margin-top: 1rem;
      padding: 1.25rem;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
    }

    .terrain-cta-text {
      font-size: 0.85rem;
      color: #4b5563;
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .terrain-cta-btn {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      background: #1a1a1a;
      color: white;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
    }

    .terrain-cta-btn:hover {
      background: #404040;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* COLONNE GAUCHE - ÉNERGIE + PLAN + INFOS MAISON */
    .left-column {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1.5rem;
    }

    /* SECTION ÉNERGIE + PLAN CÔTE À CÔTE */
    .energy-plan-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .energy-section {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
    }

    .energy-section h3 {
      font-size: 1rem;
      color: #222;
      margin-bottom: 0.75rem;
    }

    .energy-visual {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .house-icon {
      width: 40px;
      height: 40px;
      flex-shrink: 0;
    }

    .rating-scale {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .rating-bar {
      display: flex;
      align-items: center;
      height: 16px;
      padding: 0 8px;
      color: white;
      opacity: 0.7;
      font-size: 0.75rem;
      transition: all 0.3s ease;
      clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 50%, calc(100% - 8px) 100%, 0 100%);
      width: 140px;
    }

    .rating-bar.active {
      opacity: 1;
      width: 160px;
      transform: translateX(6px);
      box-shadow: 0 0 12px rgba(0, 106, 255, 0.4);
    }

    .rating-label {
      font-weight: bold;
      margin-right: 6px;
      min-width: 16px;
    }

    .rating-A-plus { background-color: #1B5E20; }
    .rating-A { background-color: #2E7D32; }
    .rating-B { background-color: #388E3C; }
    .rating-C { background-color: #8BC34A; }
    .rating-D { background-color: #FFEB3B; color: #000; }
    .rating-E { background-color: #FFC107; color: #000; }
    .rating-F { background-color: #FF9800; }
    .rating-G { background-color: #F44336; }

    .energy-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }

    .energy-bar {
      width: 100%;
      height: 4px;
      background: #eee;
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .energy-details {
      font-size: 0.75rem;
      color: #555;
      line-height: 1.3;
    }

    /* SECTION PLAN À CÔTÉ DE L'ÉNERGIE */
    .plan-section {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
      display: flex;
      flex-direction: column;
    }

    .plan-section h3 {
      font-size: 1rem;
      color: #222;
      margin-bottom: 0.75rem;
      text-align: center;
    }

    .plan-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
    }

    .plan-content img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .plan-fallback {
      text-align: center;
      color: #999;
    }

    .plan-fallback-box {
      width: 100px;
      height: 70px;
      background: #f0f0f0;
      border-radius: 4px;
      margin: 0 auto 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    /* INFOS MAISON */
    .dimensions-section {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
    }

    .dimensions-section h3 {
      font-size: 1rem;
      color: #222;
      margin-bottom: 0.75rem;
    }

    .dim-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    .dim-card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .dim-card strong {
      font-size: 1.1rem;
      color: #222;
    }

    .dim-card span {
      font-size: 0.85rem;
      color: #666;
    }

    /* SECTION CTA */
    /* SECTION CTA REFONTE - 2 OPTIONS */
    .cta-section {
      margin-top: 2rem;
      padding: 0 0 3rem 0;
      background: transparent;
      border-radius: 0;
      border: none;
    }

    .cta-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: #1a1a1a;
    }

    .cta-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .cta-card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.2s ease;
    }

    .cta-card:hover {
      border-color: #d1d5db;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .cta-card-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .cta-card-icon {
      width: 32px;
      height: 32px;
      color: #1a1a1a;
    }

    .cta-card-title {
      font-size: 1rem;
      font-weight: 600;
      color: #1a1a1a;
      margin: 0;
    }

    .cta-card-description {
      font-size: 0.85rem;
      color: #6b7280;
      line-height: 1.5;
      margin-bottom: 1.25rem;
      min-height: 60px;
    }

    .cta-card-text {
      font-size: 0.85rem;
      color: #6b7280;
      line-height: 1.5;
      margin-bottom: 1.25rem;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cta-card-btn {
      display: inline-block;
      width: 100%;
      padding: 0.85rem 1rem;
      background: #1a1a1a;
      color: white;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .cta-card-btn:hover {
      background: #404040;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* Formulaire de téléchargement inline */
    .download-form-inline {
      margin-top: 2rem;
      padding: 2rem;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .download-form-title {
      font-size: 1rem;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    /* MODALS / POP-UPS - DESIGN PREMIUM */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(26, 26, 26, 0.75);
      z-index: 999999;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(8px);
      animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modal.active {
      display: flex !important;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 650px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    @keyframes slideUp {
      from {
        transform: translateY(40px) scale(0.96);
        opacity: 0;
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    .modal-header {
      padding: 2rem 2rem 1.5rem;
      border-bottom: 1px solid #f0f0f0;
      position: relative;
    }

    .modal-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
    }

    .modal-subtitle {
      font-size: 0.9rem;
      color: #6b7280;
      font-weight: 400;
    }

    .modal-close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      color: #9ca3af;
      transition: all 0.2s ease;
      font-weight: 300;
    }

    .modal-close:hover {
      background: #f3f4f6;
      color: #1a1a1a;
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 2rem;
    }

    /* Formulaire dans modal */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-size: 0.9rem;
      font-weight: 500;
      color: #374151;
      margin-bottom: 0.5rem;
    }

    .form-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #006aff;
      box-shadow: 0 0 0 3px rgba(0, 106, 255, 0.1);
    }

    .form-checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .form-checkbox {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .form-checkbox:hover {
      background: #f8fafc;
      border-color: #cbd5e1;
    }

    .form-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .form-checkbox label {
      flex: 1;
      font-size: 0.85rem;
      color: #374151;
      cursor: pointer;
    }

    .btn-primary {
      width: 100%;
      padding: 1rem;
      background: #006aff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary:hover {
      background: #0056d6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 106, 255, 0.3);
    }

    .btn-primary:disabled {
      background: #cbd5e1;
      cursor: not-allowed;
      transform: none;
    }

    /* Calendly iframe */
    .calendly-container {
      width: 100%;
      min-height: 700px;
    }

    /* COLONNE DROITE - CONFIGURATION */
    .right-column {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    /* GRILLE 3x2 POUR LES CONFIGURATIONS */
    .config-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .config-group {
      margin-bottom: 0;
    }

    .config-group h3 {
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
      color: #333;
      font-weight: 600;
    }

    .config-options {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .config-option {
      text-align: center;
      width: 50px;
    }

    .config-swatch {
      width: 50px;
      height: 50px;
      border: 2px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
      transform-origin: center;
    }

    .config-swatch:hover { 
      border-color: #999;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .config-swatch.selected { 
      border-color: #006aff;
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0, 106, 255, 0.3);
    }

    .config-swatch.selected::after {
      content: '✔';
      position: absolute;
      top: 2px;
      right: 4px;
      color: #006aff;
      font-size: 1rem;
    }

    .config-option-label {
      font-size: 0.7rem;
      margin-top: 0.25rem;
      line-height: 1.1;
      color: #444;
    }

    .config-option-price {
      font-size: 0.65rem;
      color: #666;
    }

    /* Style spécial pour "Sans pergola" */
    .config-swatch.no-pergola {
      background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), 
                  linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), 
                  linear-gradient(45deg, transparent 75%, #f0f0f0 75%), 
                  linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
      background-size: 8px 8px;
      background-position: 0 0, 0 4px, 4px -4px, -4px 0px;
      background-color: #ffffff;
    }

    /* PRIX ET BOUTONS */
    .price-section {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
      margin-top: 0.75rem;
    }

    .price-section h3 {
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
    }

    .price-item {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
      padding: 0.25rem 0;
      border-bottom: 1px solid #e2e8f0;
    }

    .price-item:last-child {
      border-bottom: none;
      font-weight: bold;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 2px solid #ccc;
    }

    /* SECTION EMAIL + BOUTONS */
    .email-section {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
      margin-top: 0.75rem;
    }

    .email-input-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .email-input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.85rem;
      transition: border-color 0.3s ease;
    }

    .email-input:focus {
      outline: none;
      border-color: #006aff;
      box-shadow: 0 0 0 3px rgba(0, 106, 255, 0.1);
    }
.contact-input-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

.contact-input {
  padding: 0.75rem;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 0.85rem;
  transition: border-color 0.3s ease;
}

.contact-input:focus {
  outline: none;
  border-color: #006aff;
  box-shadow: 0 0 0 3px rgba(0, 106, 255, 0.1);
}

.contact-input::placeholder {
  color: #9ca3af;
}
    .action-buttons {
      display: flex;
      gap: 0.75rem;
    }

    .action-buttons button {
      flex: 1;
      padding: 0.75rem;
      font-size: 0.85rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .action-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-save {
      background: #D4C4A3;
      color: #333;
    }

    .btn-save:hover {
      background: #C4B493;
    }

    .btn-quote {
      background: #006aff;
      color: #fff;
    }

    .btn-quote:hover {
      background: #0056d6;
    }

    .btn-quote:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .btn-quote.loading {
      background: #999;
      cursor: wait;
    }

    .btn-quote.loading::after {
      content: ' ⏳';
    }

    /* RESPONSIVE MOBILE */
    @media (max-width: 768px) {
      #configurator {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        gap: 0;
        padding: 0;
      }

      /* Panneau gauche devient la partie supérieure */
      .left-panel {
        position: relative;
        height: auto;
      }

      /* Panneau droit devient scrollable en dessous */
      .right-panel {
        height: auto;
      }

      .top-section {
        height: 40vh;
        min-height: 300px;
      }

      /* MODÈLE 3D EN PLEINE LARGEUR EN HAUT */
      .viewer-card {
        border-radius: 0;
      }

      /* Summary section mobile */
      .summary-section.visible {
        max-height: 300px;
        padding: 1rem;
      }

      .summary-title {
        font-size: 0.9rem;
      }

      .summary-item {
        font-size: 0.75rem;
        padding: 0.4rem;
      }

      /* Lifestyle cards en colonne sur mobile - UNE PAR UNE */
      .lifestyle-cards {
        grid-template-columns: 1fr !important;
        gap: 1rem;
      }

      .lifestyle-card {
        padding: 0;
        max-width: 100%;
      }

      .lifestyle-icon {
        height: 180px;
      }

      .lifestyle-title {
        font-size: 0.95rem;
        margin: 1rem 1rem 0.5rem;
      }

      .lifestyle-description {
        font-size: 0.8rem;
        margin: 0 1rem;
        padding-bottom: 1rem;
      }

      .lifestyle-btn {
        margin: 0 1rem 1rem;
        padding: 0.6rem 1.2rem;
      }

      /* Section CTA mobile - pleine largeur et bien espacée */
      .cta-section {
        order: 20;  /* Après le récapitulatif (order: 10) */
        padding: 1.5rem 1rem 2rem 1rem !important;
        margin-top: 1.5rem;
      }

      .cta-title {
        font-size: 1.1rem;
        margin-bottom: 1.25rem;
        text-align: left;
      }

      /* CTA Options en colonne sur mobile - UNE PAR LIGNE */
      .cta-options {
        display: flex !important;
        flex-direction: column !important;
        grid-template-columns: none !important;
        gap: 1rem;
        width: 100%;
      }

      .cta-card {
        width: 100%;
        padding: 1.5rem;
        box-sizing: border-box;
      }

      .cta-card-header {
        margin-bottom: 1rem;
      }

      .cta-card-icon {
        width: 28px;
        height: 28px;
      }

      .cta-card-title {
        font-size: 1rem;
      }

      .cta-card-description {
        min-height: auto;
        margin-bottom: 1.25rem;
        font-size: 0.875rem;
        line-height: 1.5;
      }

      .cta-card-text {
        min-height: auto;
        margin-bottom: 1rem;
      }

      .cta-card-btn {
        padding: 0.875rem 1rem;
        font-size: 0.9rem;
      }

      /* Formulaire download en colonne sur mobile */
      .download-form-inline {
        padding: 1.5rem;
        margin-top: 1.5rem;
      }

      .download-form-title {
        font-size: 0.95rem;
        margin-bottom: 1.25rem;
      }

      .form-row {
        display: flex !important;
        flex-direction: column !important;
        grid-template-columns: none !important;
        gap: 1rem;
      }

      .form-group {
        width: 100%;
      }

      .form-label {
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
      }

      .form-input {
        width: 100%;
        padding: 0.875rem;
        font-size: 0.9rem;
        box-sizing: border-box;
      }

      .btn-primary {
        width: 100%;
        padding: 1rem;
        font-size: 0.95rem;
        margin-top: 0.5rem;
      }

      /* Modal adapté mobile */
      .modal-content {
        width: 95%;
        max-height: 95vh;
      }

      .modal-header {
        padding: 1.5rem 1rem 1rem;
      }

      .modal-title {
        font-size: 1.1rem;
      }

      .modal-body {
        padding: 1rem;
      }

      .calendly-container {
        min-height: 500px;
      }

      /* CTA section mobile */
      .cta-section {
        padding: 1rem;
      }

      .cta-option {
        padding: 1rem;
      }

      .cta-label {
        font-size: 0.85rem;
      }
      
      .rotation-indicators {
        bottom: 10px;
      }
      
      .rotation-hint {
        padding: 8px 16px;
        font-size: 0.7rem;
        gap: 8px;
      }
      
      .rotation-arrow {
        width: 20px;
        height: 20px;
        font-size: 10px;
      }
      
      /* SECTION CONFIGURATION MOBILE */
      .bottom-section {
        border-radius: 0;
        padding: 1rem;
        order: 2;
      }
      
      .config-header {
        padding: 1.5rem 1rem;
        text-align: center;
        border-bottom: 1px solid #e5e7eb;
      }

      .config-header h2 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        font-weight: 600;
      }

      .config-header .current-price {
        font-size: 1.6rem;
        margin-bottom: 0;
        font-weight: 700;
      }
      
      /* Forcer le layout mobile en colonne unique */
      .config-content {
        display: flex !important;
        flex-direction: column !important;
        grid-template-columns: none !important;
        gap: 0.75rem;
        padding: 1rem;
      }

      /* Accordéons en pleine largeur sur mobile */
      .accordion-section {
        width: 100%;
        margin-bottom: 0.5rem;
      }

      .accordion-header {
        padding: 1rem;
      }

      .accordion-title {
        font-size: 0.9rem;
      }

      .accordion-content {
        padding: 0 !important;  /* Pas de padding quand fermé */
      }

      .accordion-content.active {
        padding: 0 1rem 1rem 1rem !important;  /* Padding seulement quand ouvert */
      }

      /* Récapitulatif : placer AVANT la section CTA */
      .price-section {
        order: 10;  /* Après les accordéons (1-5) mais avant CTA (20) */
        width: 100%;
        margin-top: 1rem;
        padding: 1rem;
      }

      .price-section h3 {
        font-size: 1rem;
        margin-bottom: 0.75rem;
      }

      #price-breakdown {
        font-size: 0.85rem;
      }

      .price-item {
        padding: 0.5rem 0;
      }

      /* ÉNERGIE + PLAN EN COLONNE SUR MOBILE */
      .energy-plan-section {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
      
      /* COLONNE GAUCHE MOBILE */
      .left-column {
        gap: 0.5rem;
      }
      
      .energy-section {
        padding: 0.5rem;
      }
      
      .energy-section h3 {
        font-size: 0.7rem;
        margin-bottom: 0.4rem;
      }
      
      .energy-visual {
        gap: 0.4rem;
        margin-bottom: 0.4rem;
      }
      
      .house-icon {
        width: 16px;
        height: 16px;
      }
      
      .rating-bar {
        height: 6px;
        padding: 0 3px;
        font-size: 0.4rem;
        clip-path: polygon(0 0, calc(100% - 3px) 0, 100% 50%, calc(100% - 3px) 100%, 0 100%);
        width: 60px;
        gap: 1px;
      }
      
      .rating-bar.active {
        width: 65px;
        transform: translateX(2px);
        box-shadow: 0 0 8px rgba(0, 106, 255, 0.3);
      }
      
      .rating-label {
        margin-right: 1px;
        min-width: 6px;
      }
      
      .energy-info {
        font-size: 0.6rem;
        margin-bottom: 0.15rem;
      }
      
      .energy-bar {
        height: 2px;
        margin-bottom: 0.25rem;
      }
      
      .energy-details {
        font-size: 0.55rem;
        line-height: 1.1;
      }
      
      /* PLAN MOBILE */
      .plan-section {
        padding: 0.5rem;
      }
      
      .plan-section h3 {
        font-size: 0.7rem;
        margin-bottom: 0.4rem;
      }
      
      /* DIMENSIONS MOBILE */
      .dimensions-section {
        padding: 0.5rem;
      }
      
      .dimensions-section h3 {
        font-size: 0.7rem;
        margin-bottom: 0.4rem;
      }
      
      .dim-grid {
        gap: 0.25rem;
      }
      
      .dim-card {
        padding: 0.4rem;
        border-radius: 3px;
      }
      
      .dim-card strong {
        font-size: 0.7rem;
      }
      
      .dim-card span {
        font-size: 0.6rem;
      }
      
      /* COLONNE DROITE MOBILE */
      .right-column {
        gap: 0.4rem;
      }
      
      .config-grid {
        gap: 0.4rem;
        margin-bottom: 0.5rem;
      }
      
      .config-group h3 {
        font-size: 0.6rem;
        margin-bottom: 0.2rem;
      }
      
      .config-options {
        gap: 0.15rem;
      }
      
      .config-option {
        width: 24px;
      }
      
      .config-swatch {
        width: 24px;
        height: 24px;
        border: 1px solid #ccc;
        border-radius: 3px;
      }
      
      .config-swatch.selected::after {
        top: 0px;
        right: 1px;
        font-size: 0.5rem;
      }
      
      .config-option-label {
        font-size: 0.5rem;
        margin-top: 0.1rem;
        line-height: 1;
      }
      
      .config-option-price {
        font-size: 0.45rem;
        line-height: 1;
      }
      
      /* PRIX MOBILE - déjà défini plus haut */

      .price-item:last-child {
        font-size: 0.65rem;
        margin-top: 0.2rem;
        padding-top: 0.2rem;
        border-top: 1px solid #ccc;
      }
      
      /* EMAIL + BOUTONS MOBILE */
     .contact-input-group {
  gap: 0.25rem;
  margin-bottom: 0.4rem;
}

.contact-input {
  padding: 0.4rem;
  font-size: 0.6rem;
}
    
      .action-buttons {
        flex-direction: column;
        gap: 0.25rem;
      }
      
      .action-buttons button {
        padding: 0.4rem;
        font-size: 0.6rem;
      }
    }

    @keyframes drift {
      0% { transform: translateY(0) translateX(0); opacity: 0.6; }
      50% { transform: translateY(-2px) translateX(2px); opacity: 0.3; }
      100% { transform: translateY(0) translateX(0); opacity: 0.6; }
    }

    .smoke path {
      animation: drift 3s infinite ease-in-out;
    }

    .house-body {
      transition: fill 0.6s ease-in-out, stroke 0.6s ease-in-out;
    }
    /* Masquer la notification Chrome GitHub */
body::before {
  display: none !important;
}

.github-notification,
.chrome-notification,
[data-testid*="github"],
[class*="github-notification"] {
  display: none !important;
}
  </style>
</head>
<body>
  <div class="fixed-price" id="fixed-price">
    <span class="fixed-price-label">Prix TTC</span>
    <span class="fixed-price-amount" id="fixed-price-amount">139 000 €</span>
  </div>

  <div id="configurator">
    <!-- PANNEAU GAUCHE - 3D FIXE + RÉSUMÉ -->
    <div class="left-panel">
      <!-- TOP SECTION - MODÈLE 3D -->
      <div class="top-section">
        <div class="viewer-card">
          <model-viewer
            id="mv"
            src="./TRADIHOME74.glb"
            alt="Maison Tradi'home"
            camera-orbit="15deg 75deg 12m"
            field-of-view="45deg"
            exposure="0.8"
            shadow-intensity="2.5"
            shadow-softness="1"
            camera-controls
            min-camera-orbit="-Infinity 0deg 8m"
            max-camera-orbit="Infinity 90deg 20m"
            camera-target="0m 1m 0m"
            interaction-prompt="none"
            
            loading="eager"
            reveal="auto"
            touch-action="pan-y"
            
            disable-tap
            interpolation-decay="200"
            
            ar
            ar-modes="webxr scene-viewer quick-look"
            ar-scale="fixed"
            
            ios-src="./TRADIHOME74.glb"
          >
            <!-- Message de chargement personnalisé -->
            <div class="loading-indicator" slot="poster">
              <div style="text-align: center; padding: 40px;">
                <div style="width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #ff6b35; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                <p style="color: #666; font-size: 16px;">Chargement du modèle 3D...</p>
              </div>
            </div>
            
            <!-- Fallback si WebGL non supporté -->
            <div slot="fallback">
              <p style="text-align: center; padding: 40px; color: #d32f2f;">
                ❌ Votre navigateur ne supporte pas la 3D.<br>
                Essayez Chrome, Safari ou Firefox.
              </p>
            </div>
          </model-viewer>
          
          <style>
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
          
          /* Style du viewer */
          #mv {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #e3f2fd, #ffffff);
          }
          
          /* Loading indicator disparaît après chargement */
          #mv[loaded] .loading-indicator {
            display: none;
          }
          </style>
          <!-- Flèches d'indication -->
          <div class="rotation-indicators">
            <div class="rotation-hint">
              <div class="rotation-arrows">
                <div class="rotation-arrow">◀</div>
                <div class="rotation-arrow">▶</div>
              </div>
              <span>Faites glisser pour faire tourner</span>
            </div>
          </div>
        </div>
      </div>

      <!-- SECTION RÉSUMÉ (s'affiche au scroll) -->
      <div class="summary-section" id="summary-section">
        <h3 class="summary-title">Votre configuration</h3>
        <div class="summary-grid" id="summary-grid">
          <!-- Sera rempli dynamiquement -->
        </div>
      </div>
    </div>

    <!-- PANNEAU DROIT - OPTIONS SCROLLABLES -->
    <div class="right-panel">
      <!-- TITRE ET PRIX -->
      <div class="config-header">
        <h2>Configuration Tradi'home</h2>
        <div class="current-price" id="total-price">139 000 €</div>
      </div>

      <div class="config-content">

        <!-- Q1: STYLE DE VIE -->
        <div class="accordion-section">
          <div class="accordion-header" onclick="toggleAccordion(this)">
            <div class="accordion-title">
              <span>Quel style de vie vous correspond ?</span>
            </div>
            <span class="accordion-toggle"></span>
          </div>
          <div class="accordion-content">
            <p style="margin-bottom: 1rem; color: #64748b; font-size: 0.9rem;">Choisissez votre univers :</p>
            <div class="lifestyle-cards">
              <!-- Card 1: Intemporel'home -->
              <div class="lifestyle-card" onclick="selectLifestyle(this, 'intemporel')">
                <div class="lifestyle-icon">
                  <img src="./intemporelhome.png" alt="Intemporel'home">
                </div>
                <h4 class="lifestyle-title">Vie de famille confortable</h4>
                <p class="lifestyle-description">Espaces généreux, terrasse pour les enfants</p>
                <a href="https://www.luly-homes.com/template/intemporelhome" target="_blank" class="lifestyle-btn">Découvrir Intemporel'home</a>
              </div>

              <!-- Card 2: Tradi'home (actuel) -->
              <div class="lifestyle-card selected" onclick="selectLifestyle(this, 'tradihome')">
                <div class="lifestyle-icon">
                  <img src="./tradi'home.png" alt="Tradi'home">
                </div>
                <h4 class="lifestyle-title">Cocon intimiste</h4>
                <p class="lifestyle-description">Couple, premier achat, optimisation espace</p>
                <span class="lifestyle-btn" style="opacity: 1; background: #1a1a1a; pointer-events: none;">Configuration actuelle</span>
              </div>

              <!-- Card 3: Modern'home -->
              <div class="lifestyle-card" onclick="selectLifestyle(this, 'modern')">
                <div class="lifestyle-icon">
                  <img src="./modernhome.png" alt="Modern'home">
                </div>
                <h4 class="lifestyle-title">Design & modernité</h4>
                <p class="lifestyle-description">Esthétique contemporaine, lignes épurées</p>
                <a href="https://www.luly-homes.com/template/modernhome" target="_blank" class="lifestyle-btn">Découvrir Modern'home</a>
              </div>
            </div>
          </div>
        </div>

        <!-- ÉNERGIE + PLAN + INFOS -->
        <div class="accordion-section">
          <div class="accordion-header active" onclick="toggleAccordion(this)">
            <div class="accordion-title">
              <span>Informations de la maison</span>
            </div>
            <span class="accordion-toggle"></span>
          </div>
          <div class="accordion-content active">
            <!-- ÉNERGIE + PLAN CÔTE À CÔTE -->
            <div class="energy-plan-section">
            <!-- SECTION ÉNERGIE -->
            <div class="energy-section">
              <h3>Performance énergétique</h3>
              <div class="energy-visual">
                <div class="house-icon">
                  <svg class="house-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path
                      class="house-body"
                      d="M20,70 L20,40 L50,15 L80,40 L80,70"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="6"
                      stroke-linejoin="round"
                      stroke-linecap="round"/>
                    <path
                      d="M65,30 L65,20"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="6"
                      stroke-linecap="round"/>
                    <g class="smoke">
                      <path
                        d="M63,17 C67,15 69,13 67,11 M67,12 C71,10 73,8 71,6"
                        fill="none"
                        stroke="#999"
                        stroke-width="1"
                        stroke-linecap="round"/>
                    </g>
                  </svg>
                </div>
                <div class="rating-scale">
                  <div class="rating-bar rating-A-plus" data-rating="A+">
                    <span class="rating-label">A+</span>
                    <span>≤50</span>
                  </div>
                  <div class="rating-bar rating-A" data-rating="A">
                    <span class="rating-label">A</span>
                    <span>51-90</span>
                  </div>
                  <div class="rating-bar rating-B" data-rating="B">
                    <span class="rating-label">B</span>
                    <span>91-150</span>
                  </div>
                  <div class="rating-bar rating-C" data-rating="C">
                    <span class="rating-label">C</span>
                    <span>151-230</span>
                  </div>
                  <div class="rating-bar rating-D" data-rating="D">
                    <span class="rating-label">D</span>
                    <span>231-330</span>
                  </div>
                  <div class="rating-bar rating-E" data-rating="E">
                    <span class="rating-label">E</span>
                    <span>331-450</span>
                  </div>
                  <div class="rating-bar rating-F" data-rating="F">
                    <span class="rating-label">F</span>
                    <span>451-590</span>
                  </div>
                  <div class="rating-bar rating-G" data-rating="G">
                    <span class="rating-label">G</span>
                    <span>>590</span>
                  </div>
                </div>
              </div>
              <div class="energy-info">
                <span>Consommation :</span>
                <span id="energy-value">45 kWh/an</span>
              </div>
              <div class="energy-info">
                <span>Classe :</span>
                <span id="energy-class">A+</span>
              </div>
              <div class="energy-bar">
                <div id="energy-bar-fill" style="width: 8%; background: #1B5E20; height: 100%;"></div>
              </div>
              <div class="energy-details">
                <span id="energy-details">Configuration de base</span>
              </div>
            </div>

            <!-- SECTION PLAN À CÔTÉ DE L'ÉNERGIE -->
            <div class="plan-section">
              <h3>Plan schématique</h3>
              <div class="plan-content">
                <img 
                  src="./PLAN.png" 
                  alt="Plan schématique de la maison"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                />
                <div class="plan-fallback" style="display: none;">
                  <div class="plan-fallback-box">Plan</div>
                  <span>Plan schématique</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- INFOS MAISON -->
          <div class="dimensions-section">
            <h3>Informations</h3>
            <div class="dim-grid">
              <div class="dim-card">
                <strong>85 m²</strong>
                <span>Surface</span>
              </div>
              <div class="dim-card">
                <strong>3 Ch</strong>
                <span>Chambres</span>
              </div>
              <div class="dim-card">
                <strong>2 SdE</strong>
                <span>Salle d'eau</span>
              </div>
            </div>
          </div>
          </div>
        </div>

        <!-- PERSONNALISATION (avec accordion) -->
        <div class="accordion-section">
          <div class="accordion-header active" onclick="toggleAccordion(this)">
            <div class="accordion-title">
              <span>Personnalisation de votre maison</span>
            </div>
            <span class="accordion-toggle"></span>
          </div>
          <div class="accordion-content active">
            <!-- GRILLE 3x2 POUR LES CONFIGURATIONS -->
            <div class="config-grid">
            <!-- Bardage -->
            <div class="config-group" data-cat="Bardage">
              <h3>Bardage</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#D4B285" data-color="#D4B285" data-cost="0" data-base="true"></div>
                  <div class="config-option-label">Chêne clair</div>
                  <div class="config-option-price">Base</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#8B4513" data-color="#8B4513" data-cost="799"></div>
                  <div class="config-option-label">Chêne foncé</div>
                  <div class="config-option-price">+799€</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#3D4C5C" data-color="#3D4C5C" data-cost="899"></div>
                  <div class="config-option-label">Gris oragé</div>
                  <div class="config-option-price">+899€</div>
                </div>
              </div>
            </div>
            
            <!-- Menuiserie -->
            <div class="config-group" data-cat="Menuiserie">
              <h3>Menuiserie</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#FFFFFF" data-color="#FFFFFF" data-cost="0" data-base="true"></div>
                  <div class="config-option-label">Blanc</div>
                  <div class="config-option-price">Base</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#2C2C2C" data-color="#2C2C2C" data-cost="2499"></div>
                  <div class="config-option-label">Anthracite</div>
                  <div class="config-option-price">+2499€</div>
                </div>
              </div>
            </div>

            <!-- Gouttière -->
            <div class="config-group" data-cat="Gouttiere">
              <h3>Gouttière</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#FFFFFF" data-color="#FFFFFF" data-cost="0" data-base="true"></div>
                  <div class="config-option-label">Blanc</div>
                  <div class="config-option-price">Base</div>
                </div>
              </div>
            </div>

            <!-- Pergola -->
            <div class="config-group" data-cat="Pergola">
              <h3>Pergola</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch no-pergola" data-color="#FFFFFF" data-cost="0" data-base="true"></div>
                  <div class="config-option-label">Sans pergola</div>
                  <div class="config-option-price">Base</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#FFFFFF" data-color="#FFFFFF" data-cost="8500"></div>
                  <div class="config-option-label">Blanc</div>
                  <div class="config-option-price">+8500€</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#2C2C2C" data-color="#2C2C2C" data-cost="9500"></div>
                  <div class="config-option-label">Anthracite</div>
                  <div class="config-option-price">+9500€</div>
                </div>
              </div>
            </div>

            <!-- Peinture -->
            <div class="config-group" data-cat="Murs">
              <h3>Peinture</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#FFFFFF" data-color="#FFFFFF" data-cost="0" data-base="true"></div>
                  <div class="config-option-label">Blanc</div>
                  <div class="config-option-price">Base</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#D4C4A3" data-color="#D4C4A3" data-cost="999"></div>
                  <div class="config-option-label">Beige Wes</div>
                  <div class="config-option-price">+999€</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color: #E6C7B1" data-color="#E6C7B1" data-cost="1499"></div>
                  <div class="config-option-label">Ocre Mojave</div>
                  <div class="config-option-price">+1499€</div>
                </div>
              </div>
            </div>

            <!-- Tôle -->
            <div class="config-group" data-cat="Toit">
              <h3>Tôle</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#9BA1A9" data-color="#9BA1A9" data-cost="0" data-base="true"></div>
                  <div class="config-option-label">Gris</div>
                  <div class="config-option-price">Base</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#1A2E3F" data-color="#1A2E3F" data-cost="0"></div>
                  <div class="config-option-label">Bleu</div>
                  <div class="config-option-price">Base</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#C0392B" data-color="#C0392B" data-cost="1800"></div>
                  <div class="config-option-label">Rouge</div>
                  <div class="config-option-price">+1800€</div>
                </div>
              </div>
            </div>
          </div>
          </div>
        </div>

        <!-- Q2: TERRAIN -->
        <div class="accordion-section">
          <div class="accordion-header" onclick="toggleAccordion(this)">
            <div class="accordion-title">
              <span>Avez-vous déjà votre terrain ?</span>
            </div>
            <span class="accordion-toggle"></span>
          </div>
          <div class="accordion-content">
            <p style="margin-bottom: 1rem; color: #64748b; font-size: 0.9rem;">💡 Pour vous guider au mieux :</p>
            <div class="radio-group">
              <div class="radio-option" onclick="selectRadio(this, 'terrain')">
                <input type="radio" name="terrain" value="oui" id="terrain-oui">
                <label for="terrain-oui" class="radio-label">
                  <strong>Oui, j'ai mon terrain</strong>
                </label>
              </div>
              <div class="conditional-field" id="terrain-oui-field">
                <input type="text" placeholder="Indiquez la commune" id="commune-actuel">
              </div>

              <div class="radio-option" onclick="selectRadio(this, 'terrain')">
                <input type="radio" name="terrain" value="sais-ou" id="terrain-sais-ou">
                <label for="terrain-sais-ou" class="radio-label">
                  <strong>Non, mais je sais où construire</strong>
                </label>
              </div>
              <div class="conditional-field" id="terrain-sais-ou-field">
                <input type="text" placeholder="Indiquez la commune" id="commune-futur">
              </div>

              <div class="radio-option" onclick="selectRadio(this, 'terrain')">
                <input type="radio" name="terrain" value="cherche" id="terrain-cherche">
                <label for="terrain-cherche" class="radio-label">
                  <strong>Non, je cherche encore</strong>
                </label>
              </div>

              <!-- CTA Box conditionnel pour "cherche" -->
              <div class="terrain-cta-box" id="terrain-cherche-cta" style="display: none;">
                <p class="terrain-cta-text">
                  Vous cherchez encore votre terrain ? On peut en parler ensemble et vous aider à identifier le bon emplacement selon votre projet et votre mode de vie.
                </p>
                <button class="terrain-cta-btn" onclick="openCalendlyFromTerrain()">
                  Parler avec un conseiller
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Q3: TIMELINE -->
        <div class="accordion-section">
          <div class="accordion-header" onclick="toggleAccordion(this)">
            <div class="accordion-title">
              <span>Quand souhaitez-vous emménager ?</span>
            </div>
            <span class="accordion-toggle"></span>
          </div>
          <div class="accordion-content">
            <p style="margin-bottom: 1rem; color: #64748b; font-size: 0.9rem;">📅 Votre timeline idéale :</p>
            <div class="radio-group">
              <div class="radio-option" onclick="selectRadio(this, 'timeline')">
                <input type="radio" name="timeline" value="3-6-mois" id="timeline-rapide">
                <label for="timeline-rapide" class="radio-label">
                  <strong>Le plus tôt possible (3-6 mois)</strong>
                </label>
              </div>

              <div class="radio-option" onclick="selectRadio(this, 'timeline')">
                <input type="radio" name="timeline" value="6-12-mois" id="timeline-moyen">
                <label for="timeline-moyen" class="radio-label">
                  <strong>D'ici 6-12 mois</strong>
                </label>
              </div>

              <div class="radio-option" onclick="selectRadio(this, 'timeline')">
                <input type="radio" name="timeline" value="plus-1-an" id="timeline-long">
                <label for="timeline-long" class="radio-label">
                  <strong>Dans plus d'un an (je prépare mon projet)</strong>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- PRIX -->
        <div class="price-section" style="margin-top: 1.5rem;">
          <h3>Récapitulatif</h3>
          <div id="price-breakdown">
            <div class="price-item">
              <span>Prix de base</span>
              <span>139 000 €</span>
            </div>
            <div class="price-item">
              <span>Total TTC</span>
              <span id="total-price-display">139 000 €</span>
            </div>
          </div>
        </div>

        <!-- SECTION CTA - NOUVELLE VERSION 2 CARTES -->
        <div class="cta-section">
          <h3 class="cta-title">Prochaine étape :</h3>
          <div class="cta-options">
            <!-- Option 1: Parler avec un conseiller -->
            <div class="cta-card">
              <div class="cta-card-header">
                <svg class="cta-card-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                <h4 class="cta-card-title">Parler avec un conseiller</h4>
              </div>
              <p class="cta-card-description">
                Échangez avec un conseiller pour clarifier vos choix, optimiser votre budget et structurer votre projet.
              </p>
              <button class="cta-card-btn" onclick="openModal('modal-calendly')">Prendre rendez-vous</button>
            </div>

            <!-- Option 2: Télécharger la configuration -->
            <div class="cta-card">
              <div class="cta-card-header">
                <svg class="cta-card-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                <h4 class="cta-card-title">Télécharger ma configuration</h4>
              </div>
              <p class="cta-card-description">
                Téléchargez votre configuration pour la consulter, la comparer ou la partager.
              </p>
              <button class="cta-card-btn" onclick="toggleDownloadForm()">Télécharger</button>
            </div>
          </div>

          <!-- Formulaire de téléchargement (caché par défaut) -->
          <div id="download-form-section" class="download-form-inline" style="display: none;">
            <h4 class="download-form-title">Recevez votre configuration par email</h4>
            <form id="download-form-inline" onsubmit="submitDownloadFormInline(event)">
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Prénom *</label>
                  <input type="text" class="form-input" id="download-prenom-inline" required placeholder="Jean">
                </div>

                <div class="form-group">
                  <label class="form-label">Nom *</label>
                  <input type="text" class="form-input" id="download-nom-inline" required placeholder="Dupont">
                </div>

                <div class="form-group">
                  <label class="form-label">Email *</label>
                  <input type="email" class="form-input" id="download-email-inline" required placeholder="jean.dupont@email.com">
                </div>
              </div>

              <button type="submit" class="btn-primary">
                Télécharger ma configuration
              </button>
            </form>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- MODAL CALENDLY -->
  <div class="modal" id="modal-calendly">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <h3 class="modal-title">Parlez à nos Maître constructeur</h3>
          <p class="modal-subtitle">Obtenez votre devis en 2 minutes</p>
        </div>
        <button class="modal-close" onclick="closeModal('modal-calendly')">×</button>
      </div>
      <div class="modal-body" style="padding: 0;">
        <!-- Widget Calendly -->
        <div class="calendly-inline-widget calendly-container" data-url="https://calendly.com/lulyhomes/30min?hide_event_type_details=1&hide_gdpr_banner=1"></div>
      </div>
    </div>
  </div>

  <!-- MODAL INFORMATIONS -->
  <div class="modal" id="modal-info">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <h3 class="modal-title">Demande d'informations</h3>
          <p class="modal-subtitle">Nous vous recontacterons rapidement</p>
        </div>
        <button class="modal-close" onclick="closeModal('modal-info')">×</button>
      </div>
      <div class="modal-body">
        <form id="info-form" onsubmit="submitInfoForm(event)">
          <div class="form-group">
            <label class="form-label">Nom et prénom *</label>
            <input type="text" class="form-input" id="info-name" required placeholder="Jean Dupont">
          </div>

          <div class="form-group">
            <label class="form-label">Téléphone *</label>
            <input type="tel" class="form-input" id="info-phone" required placeholder="06 12 34 56 78">
          </div>

          <div class="form-group">
            <label class="form-label">Email *</label>
            <input type="email" class="form-input" id="info-email" required placeholder="jean.dupont@email.com">
          </div>

          <div class="form-group">
            <label class="form-label">Comment pouvons-nous vous aider ?</label>
            <div class="form-checkbox-group">
              <div class="form-checkbox">
                <input type="checkbox" id="help-rdv" name="help" value="rdv">
                <label for="help-rdv">Je suis prêt, je veux un rendez-vous</label>
              </div>
              <div class="form-checkbox">
                <input type="checkbox" id="help-financement" name="help" value="financement">
                <label for="help-financement">J'ai des questions sur le financement</label>
              </div>
              <div class="form-checkbox">
                <input type="checkbox" id="help-visite" name="help" value="visite">
                <label for="help-visite">Je veux visiter une maison témoin</label>
              </div>
              <div class="form-checkbox">
                <input type="checkbox" id="help-recap" name="help" value="recap">
                <label for="help-recap">J'aimerais juste recevoir le récapitulatif pour l'instant</label>
              </div>
            </div>
          </div>

          <button type="submit" class="btn-primary">
            Envoyer ma demande
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- MODAL TÉLÉCHARGEMENT -->
  <div class="modal" id="modal-download">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <h3 class="modal-title">Télécharger votre configuration</h3>
          <p class="modal-subtitle">Recevez votre configuration par email</p>
        </div>
        <button class="modal-close" onclick="closeModal('modal-download')">×</button>
      </div>
      <div class="modal-body">
        <form id="download-form" onsubmit="submitDownloadForm(event)">
          <div class="form-group">
            <label class="form-label">Prénom *</label>
            <input type="text" class="form-input" id="download-prenom" required placeholder="Jean">
          </div>

          <div class="form-group">
            <label class="form-label">Nom *</label>
            <input type="text" class="form-input" id="download-nom" required placeholder="Dupont">
          </div>

          <div class="form-group">
            <label class="form-label">Email *</label>
            <input type="email" class="form-input" id="download-email" required placeholder="jean.dupont@email.com">
          </div>

          <button type="submit" class="btn-primary">
            Télécharger ma configuration
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Script Calendly -->
  <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>

  <script>
   
    // ⚙️ CONFIGURATION WEBHOOK - URL N8N
    const WEBHOOK_URL = 'https://naiom.app.n8n.cloud/webhook/submit-config'; 
    
    // Configuration des impacts énergétiques par matériau et couleur
    // Ajustés pour avoir config de base en A+ (~45 kWh/an) et pire cas en B (~140 kWh/an max)
    // Plus les couleurs sont foncées, plus l'impact énergétique est élevé
    const energyImpact = {
      Bardage: {
        '#D4B285': 0,   // Chêne clair (base A+) - pas d'impact
        '#8B4513': 25,  // Chêne foncé (plus foncé = plus énergivore)
        '#3D4C5C': 45   // Gris oragé (très foncé = très énergivore)
      },
      Toit: {
        '#9BA1A9': 0,   // Gris clair (base A+) - pas d'impact
        '#1A2E3F': 35,  // Bleu foncé (plus énergivore)
        '#C0392B': 30   // Rouge (moyennement énergivore)
      },
      Pergola: {
        '#FFFFFF': 0,   // Sans pergola ou Blanc (base A+) - pas d'impact
        '#2C2C2C': 40   // Anthracite très foncé (très énergivore)
      },
      Murs: {
        '#FFFFFF': 0,   // Blanc (base A+) - pas d'impact
        '#D4C4A3': 15,  // Beige (moyennement énergivore)
        '#E6C7B1': 25   // Ocre (plus énergivore)
      },
      Menuiserie: {
        '#FFFFFF': 0,   // Blanc (base A+) - pas d'impact
        '#2C2C2C': 30   // Anthracite foncé (énergivore)
      },
      Gouttiere: {
        '#FFFFFF': 0    // Blanc uniquement (base A+) - pas d'impact
      }
    };

    // Couleurs pour les classes énergétiques
    const ratingColors = {
      'Aplus': '#1B5E20',
      'A': '#2E7D32',
      'B': '#388E3C',
      'C': '#8BC34A',
      'D': '#FFEB3B',
      'E': '#FFC107',
      'F': '#FF9800',
      'G': '#F44336'
    };

    // Fonction pour déterminer la classe énergétique
    function getEnergyClass(kwh) {
      if(kwh <= 50) return 'Aplus';
      if(kwh <= 90) return 'A';
      if(kwh <= 150) return 'B';
      if(kwh <= 230) return 'C';
      if(kwh <= 330) return 'D';
      if(kwh <= 450) return 'E';
      if(kwh <= 590) return 'F';
      return 'G';
    }

    // Mapping des catégories vers les noms des matériaux dans le modèle 3D
    const targets = {
      Bardage:    ['poutrine01'],
      Menuiserie: ['porte','cadre porte fenetre','volets','encadrement'],
      Gouttiere:  ['goutieres'],
      Pergola:    ['poutres','volet_pergola'],
      Murs:       ['murs'],
      Toit:       ['toit1','toit contour']
    };

    // Conversion couleur hexadécimale vers RGBA
    function hex2rgba(h) {
      const v = parseInt(h.slice(1), 16);
      return [
        (v >> 16 & 255) / 255,
        (v >> 8 & 255) / 255,
        (v & 255) / 255,
        1
      ];
    }

    // Variables globales
    let selection = {};
    let qualificationData = {
      lifestyle: 'tradihome',
      terrain: null,
      commune: null,
      timeline: null
    };
    const basePrice = 139000;

    // ========== FONCTION DE TRACKING CENTRALISÉE ==========

    /**
     * Fonction de tracking pour Google Ads, GA4 et Meta Pixel
     * @param {string} conversionType - 'pdf_download' ou 'calendly_booking'
     * @param {number} value - Valeur de la conversion en euros
     * @param {object} extraData - Données additionnelles (optionnel)
     */
    function trackConversion(conversionType, value, extraData = {}) {
      console.log('📊 =================================');
      console.log('📊 TRACKING CONVERSION:', conversionType);
      console.log('📊 Valeur:', value + '€');
      console.log('📊 Extra data:', extraData);
      console.log('📊 =================================');

      // 1. GOOGLE ADS - Conversion avec VRAIS labels générés par Google
      if (typeof gtag !== 'undefined') {
        // Labels de conversion Google Ads (générés automatiquement)
        const conversionLabels = {
          'pdf_download': 'dwmhCJ2fi_IbEOfm3ahC',      // Téléchargement PDF Configurateur
          'calendly_booking': 'B74ICJaQjPIbEOfm3ahC'   // Prise RDV Calendly Configurateur
        };

        const adsPayload = {
          'send_to': 'AW-17802163047/' + conversionLabels[conversionType],
          'value': value,
          'currency': 'EUR'
        };

        console.log('🎯 Google Ads - Envoi conversion:', adsPayload);
        gtag('event', 'conversion', adsPayload);
        console.log('✅ Google Ads conversion envoyée');

        // 2. GOOGLE ANALYTICS 4 - Événement personnalisé
        // ⚠️ Pour GA4, on n'utilise PAS 'send_to', l'événement va automatiquement à tous les tags configurés
        const ga4Payload = {
          'event_category': 'Conversion',
          'event_label': conversionType === 'pdf_download' ? 'Téléchargement PDF' : 'Prise RDV Calendly',
          'value': value,
          'currency': 'EUR',
          ...extraData
        };

        console.log('📈 GA4 - Envoi événement:', conversionType, ga4Payload);
        gtag('event', conversionType, ga4Payload);
        console.log('✅ GA4 événement envoyé à G-864MHX1HKR');

      } else {
        console.error('❌ gtag not loaded - tracking impossible');
      }

      // 3. META PIXEL - Lead event
      if (typeof fbq !== 'undefined') {
        const metaPayload = {
          content_name: conversionType === 'pdf_download' ? 'PDF Configuration Tradihome' : 'RDV Calendly Tradihome',
          content_category: 'Configurateur',
          value: value,
          currency: 'EUR'
        };

        console.log('📘 Meta Pixel - Envoi Lead:', metaPayload);
        fbq('track', 'Lead', metaPayload);
        console.log('✅ Meta Pixel Lead envoyé');

        // Envoi également de l'événement custom détaillé (pdf_download ou calendly_booking)
        fbq('trackCustom', conversionType, metaPayload);
        console.log('✅ Meta Pixel custom event envoyé:', conversionType);

      } else {
        console.error('❌ fbq not loaded - Meta Pixel tracking impossible');
      }

      console.log('📊 ================================= FIN TRACKING');
    }

    // ========== NOUVELLES FONCTIONS POUR L'INTERFACE ==========

    // Fonction pour toggle les accordéons
    function toggleAccordion(header) {
      const content = header.nextElementSibling;
      const isActive = header.classList.contains('active');

      // Toggle l'état actif
      header.classList.toggle('active');
      content.classList.toggle('active');
    }

    // Fonction pour sélectionner le style de vie
    function selectLifestyle(card, lifestyle) {
      // Retirer la sélection de toutes les cards
      document.querySelectorAll('.lifestyle-card').forEach(c => {
        c.classList.remove('selected');
      });

      // Ajouter la sélection à la card cliquée
      card.classList.add('selected');
      qualificationData.lifestyle = lifestyle;

      // Mettre à jour le résumé
      updateSummarySection();
    }

    // Fonction pour sélectionner les options radio
    function selectRadio(option, groupName) {
      const radio = option.querySelector('input[type="radio"]');
      radio.checked = true;

      // Retirer la classe selected de toutes les options du groupe
      option.parentElement.querySelectorAll('.radio-option').forEach(opt => {
        opt.classList.remove('selected');
      });

      // Ajouter la classe selected à l'option cliquée
      option.classList.add('selected');

      // Gestion des champs conditionnels
      if (groupName === 'terrain') {
        // Masquer tous les champs conditionnels de terrain
        document.querySelectorAll('[id^="terrain-"][id$="-field"]').forEach(field => {
          field.classList.remove('visible');
        });

        // Afficher le champ conditionnel approprié
        const fieldId = radio.id + '-field';
        const conditionalField = document.getElementById(fieldId);
        if (conditionalField) {
          conditionalField.classList.add('visible');
        }

        // Gestion du CTA box pour "Non, je cherche encore"
        const terrainCtaBox = document.getElementById('terrain-cherche-cta');
        if (terrainCtaBox) {
          if (radio.value === 'cherche') {
            terrainCtaBox.style.display = 'block';
          } else {
            terrainCtaBox.style.display = 'none';
          }
        }

        qualificationData.terrain = radio.value;
      } else if (groupName === 'timeline') {
        qualificationData.timeline = radio.value;
      }

      // Mettre à jour le résumé
      updateSummarySection();
    }

    // Fonction pour sélectionner un CTA - VERSION CORRIGÉE
    function selectCTA(option, action) {
      console.log('selectCTA appelé avec action:', action);

      const radio = option.querySelector('input[type="radio"]');
      if (radio) {
        radio.checked = true;
      }

      // Actions selon le type de CTA
      if (action === 'calendly') {
        console.log('Tentative d\'ouverture du modal Calendly');
        // Délai court pour s'assurer que le DOM est prêt
        setTimeout(() => {
          openModal('modal-calendly');
        }, 50);
      } else if (action === 'financement') {
        window.open('https://www.luly-homes.com/landing-page/calculateurvsl', '_blank');
      } else if (action === 'info') {
        setTimeout(() => {
          openModal('modal-info');
        }, 50);
      }
    }

    // Fonction pour ouvrir un modal - VERSION AMÉLIORÉE IFRAME
    function openModal(modalId) {
      console.log('openModal appelé pour:', modalId);

      // Si c'est le modal Calendly, utiliser le PopupWidget au lieu du modal custom
      if (modalId === 'modal-calendly') {
        openCalendlyPopup();
        return;
      }

      const modal = document.getElementById(modalId);
      if (modal) {
        console.log('Modal trouvé, ajout de la classe active');
        modal.classList.add('active');
        modal.style.display = 'flex'; // Force l'affichage
        document.body.style.overflow = 'hidden';

        // Force le modal au-dessus de tout (pour iframe)
        modal.style.position = 'fixed';
        modal.style.zIndex = '999999';
      } else {
        console.error('Modal non trouvé:', modalId);
      }
    }

    // Fonction pour fermer un modal
    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.remove('active');
        modal.style.display = 'none';
        document.body.style.overflow = ''; // Réactiver le scroll
      }
    }

    // Fonction pour ouvrir Calendly avec PopupWidget (fonctionne dans iframe)
    function openCalendlyPopup() {
      console.log('Ouverture Calendly PopupWidget');

      // 📊 TRACKING - Conversion prise RDV Calendly
      trackConversion('calendly_booking', 75, {
        'method': 'popup_general',
        'source': 'cta_section'
      });

      // Vérifier si Calendly est chargé
      if (typeof Calendly !== 'undefined') {
        Calendly.initPopupWidget({
          url: 'https://calendly.com/lulyhomes/30min?hide_event_type_details=1&hide_gdpr_banner=1'
        });
      } else {
        console.error('Calendly non chargé, ouverture dans nouvel onglet');
        window.open('https://calendly.com/lulyhomes/30min', '_blank');
      }
    }

    // Fonction pour ouvrir Calendly depuis le CTA terrain
    function openCalendlyFromTerrain() {
      // 📊 TRACKING - Conversion prise RDV Calendly (depuis terrain)
      trackConversion('calendly_booking', 75, {
        'method': 'popup_terrain',
        'source': 'terrain_cta',
        'terrain_status': qualificationData.terrain || 'cherche'
      });

      // Ouvrir Calendly - Utilisation directe pour éviter double tracking
      if (typeof Calendly !== 'undefined') {
        Calendly.initPopupWidget({
          url: 'https://calendly.com/lulyhomes/30min?hide_event_type_details=1&hide_gdpr_banner=1'
        });
      } else {
        window.open('https://calendly.com/lulyhomes/30min', '_blank');
      }
    }

    // Fonction pour soumettre le formulaire de téléchargement (modal)
    async function submitDownloadForm(event) {
      event.preventDefault();

      const prenom = document.getElementById('download-prenom').value;
      const nom = document.getElementById('download-nom').value;
      const email = document.getElementById('download-email').value;

      // Créer l'objet de données complet
      const formData = {
        prenom,
        nom,
        email,
        ...getConfigurationData(),
        requestType: 'download'
      };

      try {
        // Envoyer vers Make.com webhook
        const response = await fetch('https://hook.eu1.make.com/jcibjkv691xvm739pfp5gbyf2n1m56kh', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        if (response.ok) {
          // 📊 TRACKING - Conversion téléchargement PDF
          trackConversion('pdf_download', 25, {
            'method': 'modal_form',
            'prenom': prenom,
            'nom': nom,
            'email': email
          });

          // Fermer le modal
          closeModal('modal-download');

          // Générer le PDF
          saveConfiguration();

          // Message de confirmation
          alert('✅ Configuration envoyée ! Le PDF va se télécharger.');

          // Réinitialiser le formulaire
          document.getElementById('download-form').reset();
        } else {
          throw new Error('Erreur lors de l\'envoi');
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('❌ Une erreur est survenue. Veuillez réessayer.');
      }
    }

    // Fonction pour afficher/masquer le formulaire de téléchargement inline
    function toggleDownloadForm() {
      const formSection = document.getElementById('download-form-section');
      if (formSection.style.display === 'none' || formSection.style.display === '') {
        formSection.style.display = 'block';
        // Scroll vers le formulaire
        setTimeout(() => {
          formSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 100);
      } else {
        formSection.style.display = 'none';
      }
    }

    // Fonction pour soumettre le formulaire de téléchargement inline
    async function submitDownloadFormInline(event) {
      event.preventDefault();

      const prenom = document.getElementById('download-prenom-inline').value;
      const nom = document.getElementById('download-nom-inline').value;
      const email = document.getElementById('download-email-inline').value;

      // Créer l'objet de données complet
      const formData = {
        prenom,
        nom,
        email,
        ...getConfigurationData(),
        requestType: 'download'
      };

      try {
        // Envoyer vers Make.com webhook
        const response = await fetch('https://hook.eu1.make.com/jcibjkv691xvm739pfp5gbyf2n1m56kh', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        if (response.ok) {
          // 📊 TRACKING - Conversion téléchargement PDF
          trackConversion('pdf_download', 25, {
            'method': 'inline_form',
            'prenom': prenom,
            'nom': nom,
            'email': email
          });

          // Générer le PDF
          saveConfiguration();

          // Message de confirmation
          alert('✅ Configuration envoyée ! Le PDF va se télécharger.');

          // Réinitialiser et masquer le formulaire
          document.getElementById('download-form-inline').reset();
          document.getElementById('download-form-section').style.display = 'none';
        } else {
          throw new Error('Erreur lors de l\'envoi');
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('❌ Une erreur est survenue. Veuillez réessayer.');
      }
    }

    // Fermer le modal en cliquant sur le backdrop
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal')) {
        closeModal(e.target.id);
      }
    });

    // Fonction pour soumettre le formulaire d'informations
    async function submitInfoForm(event) {
      event.preventDefault();

      const name = document.getElementById('info-name').value;
      const phone = document.getElementById('info-phone').value;
      const email = document.getElementById('info-email').value;

      // Récupérer les checkboxes cochées
      const helpOptions = [];
      document.querySelectorAll('input[name="help"]:checked').forEach(checkbox => {
        helpOptions.push(checkbox.value);
      });

      // Créer l'objet de données complet
      const formData = {
        name,
        phone,
        email,
        helpOptions: helpOptions.join(', '),
        ...getConfigurationData(),
        requestType: 'information'
      };

      // Envoyer via webhook
      try {
        const result = await sendQuoteToWebhook(formData);

        if (result.success) {
          alert(`✅ Votre demande a été envoyée avec succès!\n\nNous vous recontacterons rapidement à l'adresse ${email}.\n\nMerci ${name} pour votre intérêt!`);
          closeModal('modal-info');
          document.getElementById('info-form').reset();
        } else {
          throw new Error(result.error || 'Erreur inconnue');
        }
      } catch (error) {
        console.error('Erreur lors de l\'envoi:', error);
        alert(`❌ Erreur lors de l'envoi de votre demande.\n\nVeuillez réessayer ou nous contacter directement.\n\nDétails: ${error.message}`);
      }
    }

    // Fonction pour mettre à jour la section résumé
    function updateSummarySection() {
      const summaryGrid = document.getElementById('summary-grid');
      if (!summaryGrid) return;

      let html = '';

      // Style de vie
      const lifestyleLabels = {
        'intemporel': 'Intemporel\'home - Vie de famille',
        'tradihome': 'Tradi\'home - Cocon intimiste',
        'modern': 'Modern\'home - Design & modernité'
      };
      html += `
        <div class="summary-item">
          <span class="summary-item-label">🏡 Style de vie</span>
          <span class="summary-item-value">${lifestyleLabels[qualificationData.lifestyle]}</span>
        </div>
      `;

      // Terrain
      if (qualificationData.terrain) {
        const terrainLabels = {
          'oui': 'J\'ai mon terrain',
          'sais-ou': 'Je sais où construire',
          'cherche': 'Je cherche encore'
        };
        html += `
          <div class="summary-item">
            <span class="summary-item-label">📍 Terrain</span>
            <span class="summary-item-value">${terrainLabels[qualificationData.terrain]}</span>
          </div>
        `;

        // Commune si renseignée
        const commune = document.getElementById('commune-actuel')?.value ||
                        document.getElementById('commune-futur')?.value;
        if (commune) {
          html += `
            <div class="summary-item">
              <span class="summary-item-label">📍 Commune</span>
              <span class="summary-item-value">${commune}</span>
            </div>
          `;
        }
      }

      // Timeline
      if (qualificationData.timeline) {
        const timelineLabels = {
          '3-6-mois': 'Le plus tôt possible (3-6 mois)',
          '6-12-mois': 'D\'ici 6-12 mois',
          'plus-1-an': 'Dans plus d\'un an'
        };
        html += `
          <div class="summary-item">
            <span class="summary-item-label">📅 Emménagement</span>
            <span class="summary-item-value">${timelineLabels[qualificationData.timeline]}</span>
          </div>
        `;
      }

      // Personnalisation (depuis la config existante)
      Object.entries(selection).forEach(([cat, cost]) => {
        const group = document.querySelector(`.config-group[data-cat="${cat}"]`);
        if (group) {
          const selectedSwatch = group.querySelector('.config-swatch.selected');
          if (selectedSwatch) {
            const label = selectedSwatch.nextElementSibling?.textContent || '';
            const costValue = parseInt(selectedSwatch.dataset.cost) || 0;
            html += `
              <div class="summary-item">
                <span class="summary-item-label">🎨 ${cat}</span>
                <span class="summary-item-value">${label}${costValue > 0 ? ' (+' + costValue.toLocaleString('fr-FR') + '€)' : ''}</span>
              </div>
            `;
          }
        }
      });

      // Prix total
      let totalOptions = 0;
      Object.values(selection).forEach(cost => {
        totalOptions += cost;
      });
      html += `
        <div class="summary-item" style="border-top: 2px solid #e2e8f0; padding-top: 0.75rem; margin-top: 0.5rem;">
          <span class="summary-item-label" style="font-size: 1rem; font-weight: 600;">💰 Total TTC</span>
          <span class="summary-item-value" style="font-size: 1.1rem; font-weight: 700;">${(basePrice + totalOptions).toLocaleString('fr-FR')} €</span>
        </div>
      `;

      summaryGrid.innerHTML = html;
    }

    // 📧 FONCTION POUR ENVOYER LE DEVIS VIA WEBHOOK - CORRIGÉE
    async function sendQuoteToWebhook(quoteData) {
      try {
        console.log('Envoi des données vers n8n:', quoteData);
        
        // Configuration de la requête avec mode no-cors pour contourner les restrictions Chrome
        const requestOptions = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(quoteData),
          mode: 'cors' // Essaie d'abord en mode normal
        };

        let response;
        
        try {
          // Tentative normale d'abord
          response = await fetch(WEBHOOK_URL, requestOptions);
        } catch (corsError) {
          console.log('Erreur CORS détectée, tentative avec mode no-cors...');
          
          // Si échec CORS, on essaie en mode no-cors
          requestOptions.mode = 'no-cors';
          response = await fetch(WEBHOOK_URL, requestOptions);
          
          // En mode no-cors, on ne peut pas lire la réponse, donc on assume que ça a marché
          console.log('Requête envoyée en mode no-cors (Chrome)');
          return { success: true, data: 'Envoyé (mode no-cors)' };
        }

        console.log('Réponse du webhook:', response.status);

        // Si on arrive ici, c'est que la requête normale a fonctionné
        if (!response.ok) {
          const errorText = await response.text();
          console.error('Erreur réponse webhook:', errorText);
          throw new Error(`Erreur ${response.status}: ${errorText}`);
        }

        // Lecture sécurisée de la réponse
        const contentType = response.headers.get('content-type');
        let result;
        
        if (contentType && contentType.includes('application/json')) {
          result = await response.json();
        } else {
          result = await response.text();
        }

        console.log('Données envoyées avec succès:', result);
        return { success: true, data: result };
        
      } catch (error) {
        console.error('Erreur lors de l\'envoi du webhook:', error);
        
        // Si c'est une erreur de réseau/CORS sur Chrome, on considère que c'est envoyé
        if (error.message.includes('Failed to fetch') || error.message.includes('CORS')) {
          console.log('Erreur CORS/réseau - Considéré comme envoyé sur Chrome');
          return { success: true, data: 'Envoyé malgré restriction CORS' };
        }
        
        return { success: false, error: error.message };
      }
    }

    // 📋 FONCTION POUR COLLECTER TOUTES LES DONNÉES DE CONFIGURATION - CORRIGÉE ET ÉTENDUE
    function getConfigurationData() {
      const energyValue = document.getElementById('energy-value');
      const energyClass = document.getElementById('energy-class');
      const energyDetails = document.getElementById('energy-details');
      
      const selectedOptions = {};
      let totalOptions = 0;
      
      // Récupération de toutes les options sélectionnées
      document.querySelectorAll('.config-group').forEach(group => {
        const category = group.dataset.cat;
        const selectedSwatch = group.querySelector('.config-swatch.selected');
        
        if (selectedSwatch) {
          const labelElement = selectedSwatch.nextElementSibling;
          const label = labelElement ? labelElement.textContent : 'Non défini';
          const cost = parseInt(selectedSwatch.dataset.cost) || 0;
          const color = selectedSwatch.dataset.color || '#FFFFFF';
          const isBase = selectedSwatch.dataset.base === 'true';
          
          selectedOptions[category] = {
            label: label,
            cost: cost,
            color: color,
            isBase: isBase
          };
          
          if (cost > 0) {
            totalOptions += cost;
          }
        }
      });

      // Récupérer la commune si renseignée
      const commune = document.getElementById('commune-actuel')?.value ||
                      document.getElementById('commune-futur')?.value ||
                      '';

      // Structure des données à envoyer vers n8n
      const configData = {
        // Timestamp
        timestamp: new Date().toISOString(),
        dateFormatted: new Date().toLocaleDateString('fr-FR', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        }),

        // ===== NOUVELLES DONNÉES DE QUALIFICATION =====
        lifestyle: qualificationData.lifestyle,
        lifestyleLabel: {
          'intemporel': 'Intemporel\'home - Vie de famille confortable',
          'tradihome': 'Tradi\'home - Cocon intimiste',
          'modern': 'Modern\'home - Design & modernité'
        }[qualificationData.lifestyle],

        terrain: qualificationData.terrain || 'Non renseigné',
        terrainLabel: {
          'oui': 'Oui, j\'ai mon terrain',
          'sais-ou': 'Non, mais je sais où construire',
          'cherche': 'Non, je cherche encore'
        }[qualificationData.terrain] || 'Non renseigné',

        commune: commune || 'Non renseignée',

        timeline: qualificationData.timeline || 'Non renseigné',
        timelineLabel: {
          '3-6-mois': 'Le plus tôt possible (3-6 mois)',
          '6-12-mois': 'D\'ici 6-12 mois',
          'plus-1-an': 'Dans plus d\'un an'
        }[qualificationData.timeline] || 'Non renseigné',

        // Infos maison
        houseModel: 'Tradi\'home',
        surface: '85 m²',
        bedrooms: 3,
        bathrooms: 2,

        // Configuration sélectionnée
        configuration: selectedOptions,

        // Performance énergétique
        energyConsumption: energyValue ? energyValue.textContent : '45 kWh/an',
        energyClass: energyClass ? energyClass.textContent : 'A+',
        energyDetails: energyDetails ? energyDetails.textContent : 'Configuration de base',

        // Tarification
        basePrice: basePrice,
        optionsTotal: totalOptions,
        totalPrice: basePrice + totalOptions,
        totalPriceFormatted: (basePrice + totalOptions).toLocaleString('fr-FR') + ' €',

        // Métadonnées
        source: 'Configurateur Tradi\'home V2',
        userAgent: navigator.userAgent,
        url: window.location.href,

        // Détail des options (pour Google Sheets)
        bardage: selectedOptions.Bardage?.label || 'Non défini',
        bardagePrix: selectedOptions.Bardage?.cost || 0,
        menuiserie: selectedOptions.Menuiserie?.label || 'Non défini',
        menuiseriePrix: selectedOptions.Menuiserie?.cost || 0,
        gouttiere: selectedOptions.Gouttiere?.label || 'Non défini',
        gouttierePrix: selectedOptions.Gouttiere?.cost || 0,
        pergola: selectedOptions.Pergola?.label || 'Non défini',
        pergolaPrix: selectedOptions.Pergola?.cost || 0,
        peinture: selectedOptions.Murs?.label || 'Non défini',
        peinturePrix: selectedOptions.Murs?.cost || 0,
        tole: selectedOptions.Toit?.label || 'Non défini',
        tolePrix: selectedOptions.Toit?.cost || 0
      };

      return configData;
    }

    // Fonction de validation email
    function isValidEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    // Fonction de validation téléphone - CORRIGÉE
    function isValidPhone(phone) {
      // Nettoie le numéro (supprime espaces, points, tirets)
      const cleanPhone = phone.replace(/[\s\.\-\(\)]/g, '');
      
      // Regex plus permissive pour numéros français et internationaux
      const phoneRegex = /^(?:(?:\+33|0033|0)[1-9](?:[0-9]{8})|(?:\+|00)[1-9][0-9]{7,14})$/;
      
      return phoneRegex.test(cleanPhone) && cleanPhone.length >= 10;
    }

    // Fonction pour enregistrer la configuration en PDF
    function saveConfiguration() {
      try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        
        pdf.setFontSize(20);
        pdf.setTextColor(0, 106, 255);
        pdf.text('Configuration Tradi\'home', 105, 20, { align: 'center' });
        
        pdf.setFontSize(10);
        pdf.setTextColor(100, 100, 100);
        const today = new Date().toLocaleDateString('fr-FR');
        pdf.text(`Générée le ${today}`, 105, 30, { align: 'center' });
        
        let yPos = 50;
        
        pdf.setFontSize(14);
        pdf.setTextColor(0, 0, 0);
        pdf.text('Informations générales', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(10);
        pdf.text('Surface: 85 m²', 20, yPos);
        pdf.text('Chambres: 3', 80, yPos);
        pdf.text('Salle d\'eau: 2', 140, yPos);
        yPos += 20;
        
        pdf.setFontSize(14);
        pdf.text('Configuration sélectionnée', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(10);
        
        document.querySelectorAll('.config-group').forEach(group => {
          const category = group.dataset.cat;
          const selectedSwatch = group.querySelector('.config-swatch.selected');
          
          if (selectedSwatch) {
            const label = selectedSwatch.nextElementSibling.textContent;
            const cost = parseInt(selectedSwatch.dataset.cost);
            
            pdf.text(`${category}: ${label}`, 20, yPos);
            if (cost > 0) {
              pdf.text(`+${cost.toLocaleString('fr-FR')} €`, 120, yPos);
            } else {
              pdf.text('Base', 120, yPos);
            }
            yPos += 6;
          }
        });
        
        yPos += 15;
        
        const energyValue = document.getElementById('energy-value').textContent;
        const energyClass = document.getElementById('energy-class').textContent;
        
        pdf.setFontSize(14);
        pdf.text('Performance énergétique', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(10);
        pdf.text(`Consommation: ${energyValue}`, 20, yPos);
        pdf.text(`Classe énergétique: ${energyClass}`, 120, yPos);
        yPos += 20;
        
        pdf.setFontSize(14);
        pdf.text('Récapitulatif financier', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(10);
        pdf.text(`Prix de base: ${basePrice.toLocaleString('fr-FR')} €`, 20, yPos);
        yPos += 6;
        
        let totalOptions = 0;
        document.querySelectorAll('.config-group').forEach(group => {
          const selectedSwatch = group.querySelector('.config-swatch.selected');
          if (selectedSwatch) {
            const cost = parseInt(selectedSwatch.dataset.cost);
            if (cost > 0) {
              const category = group.dataset.cat;
              const label = selectedSwatch.nextElementSibling.textContent;
              totalOptions += cost;
              pdf.text(`${category} - ${label}: +${cost.toLocaleString('fr-FR')} €`, 20, yPos);
              yPos += 6;
            }
          }
        });
        
        yPos += 10;
        pdf.setFontSize(12);
        pdf.setTextColor(0, 106, 255);
        pdf.text(`TOTAL TTC: ${(basePrice + totalOptions).toLocaleString('fr-FR')} €`, 20, yPos);
        
        pdf.save(`Configuration_Tradihome_${today.replace(/\//g, '-')}.pdf`);
        
      } catch (error) {
        console.error('Erreur lors de la génération du PDF:', error);
        alert('Erreur lors de la génération du PDF. Veuillez réessayer.');
      }
    }

    // Gestionnaires d'erreurs globaux - AJOUTÉS
    window.addEventListener('error', function(event) {
      console.error('Erreur JavaScript:', event.error);
    });

    window.addEventListener('unhandledrejection', function(event) {
      console.error('Promise rejetée:', event.reason);
      event.preventDefault();
    });

    // Initialisation au chargement de la page
    window.addEventListener('DOMContentLoaded', () => {
      const mv = document.getElementById('mv');
      const totalEl = document.getElementById('total-price');
      const totalDisplayEl = document.getElementById('total-price-display');
      const fixedPriceEl = document.getElementById('fixed-price-amount');
      const energyEl = document.getElementById('energy-value');
      const classEl = document.getElementById('energy-class');
      const barFill = document.getElementById('energy-bar-fill');
      const ratingBars = document.querySelectorAll('.rating-bar');
      const houseSvg = document.querySelector('.house-svg');
      const fixedPrice = document.getElementById('fixed-price');

      // Masquer les flèches après quelques secondes
      setTimeout(() => {
        const indicators = document.querySelector('.rotation-indicators');
        if (indicators) {
          indicators.style.opacity = '0';
          setTimeout(() => {
            indicators.style.display = 'none';
          }, 1000);
        }
      }, 5000);

      // Gestion du scroll du panneau droit pour afficher le résumé
      const rightPanel = document.querySelector('.right-panel');
      const summarySection = document.getElementById('summary-section');

      if (rightPanel && summarySection) {
        rightPanel.addEventListener('scroll', () => {
          // Calculer si on est proche de la fin du scroll
          const scrollHeight = rightPanel.scrollHeight;
          const scrollTop = rightPanel.scrollTop;
          const clientHeight = rightPanel.clientHeight;

          // Afficher le résumé quand on a scrollé 60% du contenu
          if (scrollTop + clientHeight > scrollHeight * 0.6) {
            summarySection.classList.add('visible');
          } else {
            summarySection.classList.remove('visible');
          }
        });
      }

      // Gestion du prix fixe au scroll (conservé pour compatibilité mobile)
      window.addEventListener('scroll', () => {
        if (window.scrollY > 100) {
          fixedPrice.classList.add('visible');
        } else {
          fixedPrice.classList.remove('visible');
        }
      });

      // Initialiser le résumé avec les données par défaut
      updateSummarySection();

      // Event listeners pour les champs de commune
      const communeActuel = document.getElementById('commune-actuel');
      const communeFutur = document.getElementById('commune-futur');

      if (communeActuel) {
        communeActuel.addEventListener('input', updateSummarySection);
      }

      if (communeFutur) {
        communeFutur.addEventListener('input', updateSummarySection);
      }

      // Mise à jour de la performance énergétique
      function updateEnergy() {
        let totalImpact = 45; // Base A+ = 45 kWh/an
        let lines = [];
        
        Object.entries(selection).forEach(([cat]) => {
          const sw = document.querySelector(`.config-group[data-cat="${cat}"] .config-swatch.selected`);
          if(!sw) return;
          const col = sw.dataset.color;
          const impact = energyImpact[cat][col] || 0;
          totalImpact += impact;
          
          if (impact > 0) {
            const label = sw.nextElementSibling?.textContent || '';
            lines.push(`• ${cat} – ${label}: +${impact} kWh/an`);
          }
        });

        // Mise à jour de l'affichage énergétique
        if (energyEl) energyEl.textContent = `${totalImpact} kWh/an`;
        
        const cls = getEnergyClass(totalImpact);
        const displayClass = cls === 'Aplus' ? 'A+' : cls;
        
        if (classEl) classEl.textContent = displayClass;
        
        const percentage = Math.min(100, Math.round(totalImpact/590*100));
        if (barFill) {
          barFill.style.width = `${percentage}%`;
          barFill.style.background = ratingColors[cls];
        }

        // Mise à jour des barres de notation avec effet lumineux
        ratingBars.forEach(bar => {
          const rating = bar.dataset.rating;
          const isActive = (rating === 'A+' && cls === 'Aplus') || rating === cls;
          bar.classList.toggle('active', isActive);
        });

        // Changement de couleur de l'icône maison
        if (houseSvg) houseSvg.style.color = ratingColors[cls];
        
        // Mise à jour des détails énergétiques
        const detailsEl = document.getElementById('energy-details');
        if (detailsEl) {
          detailsEl.textContent = lines.length ? lines.join(', ') : 'Configuration de base';
        }
      }

      // Mise à jour du récapitulatif des prix
      function updatePriceBreakdown() {
        let totalOptions = 0;
        const items = [`<div class="price-item"><span>Prix de base</span><span>${basePrice.toLocaleString('fr-FR')} €</span></div>`];

        Object.entries(selection).forEach(([cat]) => {
          const sw = document.querySelector(`.config-group[data-cat="${cat}"] .config-swatch.selected`);
          if(!sw) return;
          const cost = +sw.dataset.cost;
          if(cost > 0) {
            totalOptions += cost;
            const label = sw.nextElementSibling?.textContent || '';
            items.push(`
              <div class="price-item">
                <span>${cat} - ${label}</span>
                <span>+${cost.toLocaleString('fr-FR')} €</span>
              </div>
            `);
          }
        });

        items.push(`
          <div class="price-item">
            <span>Total TTC</span>
            <span>${(basePrice + totalOptions).toLocaleString('fr-FR')} €</span>
          </div>
        `);

        // Mise à jour de l'affichage des prix
        const breakdownEl = document.getElementById('price-breakdown');
        if (breakdownEl) breakdownEl.innerHTML = items.join('');

        const totalPrice = `${(basePrice + totalOptions).toLocaleString('fr-FR')} €`;
        if (fixedPriceEl) fixedPriceEl.textContent = totalPrice;
        if (totalEl) totalEl.textContent = totalPrice;
        if (totalDisplayEl) totalDisplayEl.textContent = totalPrice;

        // Mettre à jour le résumé aussi
        updateSummarySection();
      }

      // Configuration des gestionnaires d'événements pour les échantillons
      function setupSwatchHandlers() {
        document.querySelectorAll('.config-group').forEach(group => {
          const cat = group.dataset.cat;
          const frags = targets[cat] || [];
          
          group.querySelectorAll('.config-swatch').forEach(sw => {
            sw.addEventListener('click', () => {
              // Retirer la sélection de tous les échantillons de cette catégorie
              document.querySelectorAll(`.config-group[data-cat="${cat}"] .config-swatch`).forEach(x => x.classList.remove('selected'));
              
              // Ajouter la sélection à l'échantillon cliqué
              sw.classList.add('selected');
              selection[cat] = +sw.dataset.cost;
              updatePriceBreakdown();
              
              // Mise à jour du modèle 3D (seulement si ce n'est pas "Sans pergola")
              if (!sw.classList.contains('no-pergola')) {
                const rgba = hex2rgba(sw.dataset.color);
                if (mv.model && mv.model.materials) {
                  mv.model.materials.forEach(m => {
                    const name = m.name.toLowerCase();
                    if(frags.some(f => name.includes(f))) {
                      m.pbrMetallicRoughness.setBaseColorFactor(rgba);
                      m.pbrMetallicRoughness.setMetallicFactor(1);
                      m.pbrMetallicRoughness.setRoughnessFactor(1);
                    }
                  });
                }
              }
              updateEnergy();
            });
          });
          
          // Auto-sélection de la première option (configuration de base)
          const first = group.querySelector('.config-swatch[data-base="true"]') || group.querySelector('.config-swatch');
          if(first) first.click();
        });
      }

      // Initialisation après le chargement du modèle 3D
      mv.addEventListener('load', () => {
        setupSwatchHandlers();
        updateEnergy();
      });
    });
  </script>
  <script>
// Détection WebGL et debug mobile
(function() {
  const canvas = document.createElement('canvas');
  const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
  
  if (!gl) {
    console.error('❌ WebGL non supporté sur cet appareil');
    
    // Affiche un message d'erreur à l'utilisateur
    const modelViewer = document.getElementById('mv');
    if (modelViewer) {
      const errorMsg = document.createElement('div');
      errorMsg.style.cssText = 'position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.95); z-index: 1000;';
      errorMsg.innerHTML = `
        <div style="text-align: center; padding: 40px; max-width: 400px;">
          <p style="font-size: 18px; color: #d32f2f; margin-bottom: 20px;">
            ⚠️ Votre navigateur ne supporte pas la 3D
          </p>
          <p style="font-size: 14px; color: #666; margin-bottom: 20px;">
            Utilisez Chrome, Safari ou Firefox pour voir le modèle 3D.
          </p>
          <button onclick="window.location.href='tel:+590590XXXXXX'" style="background: #ff6b35; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px;">
            Appeler pour assistance
          </button>
        </div>
      `;
      modelViewer.parentElement.style.position = 'relative';
      modelViewer.parentElement.appendChild(errorMsg);
    }
  } else {
    console.log('✅ WebGL supporté');
    console.log('📱 User Agent:', navigator.userAgent);
    console.log('🖥️ Screen:', window.innerWidth + 'x' + window.innerHeight);
  }
})();
</script>
</body>
</html>
